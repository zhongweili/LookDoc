## 不同版本代码如何共存

#### 问题

使用 Git 进行代码的协作同步，可以方便地合并不同的代码版本和分支，但是有时候不同分支的代码需要共存，在合并分支时 Git 会将 different 的地方视为冲突自动解决掉，怎样保证某些地方不合并呢？

#### 解决方案

.gitignore 文件可以设定好忽视的文件，不用git管理

详见 [Git 官方文档](https://git-scm.com/docs/gitignore) 或 [忽略特殊文件](http://www.liaoxuefeng.com/wiki/0013739516305929606dd18361248578c67b8067c8c017b000/0013758404317281e54b6f5375640abbb11e67be4cd49e0000)

关于 gitignore 在 sourceTree 中还有个很诡异的问题（sourceTree 会缓存一些文件导致 gitignore 文件无效），等彻底搞明白了再开个帖。。

#### 进一步问题

gitignore 只能在文件级别保证不合并，如果一个文件中只有某些参数不想合并，其他地方都需要合并，怎么办？

#### 解决方案

Yii 中有全局变量的概念，可以在配置文件中写入相应分支的全局变量值，在代码使用全局变量保证一致性，同时将配置文件假如 .gitignore 文件的列表。

Yii2 中有以下配置文件：

* common/config/params.php
* common/config/params-loacl.php
* backend/config/params.php
* backend/config/params-local.php
* frontend/config/params.php
* frontend/config/params-loacal.php

调用顺序从上到下。

读取时的规则是：echo Yii::$app->params['webPath'];

#### 进一步问题

有另外一些配置信息也不想合并，无法受配置文件控制，怎么实现？

#### 解决方案

Yii 中有一些环境常量，可以借助环境常量进行差异化配置

* prod：生产环境。常量 YII_ENV_PROD 将被看作 true。如果没修改过，这就是 YII_ENV 的默认值。
* dev：开发环境。常量 YII_ENV_DEV 将被看作 true。
* test：测试环境。常量 YII_ENV_TEST 将被看作 true。

例如，mysql 数据库在开发版和发布版环境下并不相同，可在 main-local.php 中这样配置：

>

    if(YII_ENV_DEV) {

    $config['components']['db']['dsn'] = 'mysql:host=192.168.190.201;dbname=looktki';

    $config['components']['db']['username'] = 'root';

    $config['components']['db']['password'] = 'root';
    
    }

    if(YII_ENV_PROD) {
    
    $config['components']['db']['dsn'] = 'mysql:host=looktki.cclc7yz46zk0.us-west-2.rds.amazonaws.com;dbname=looktki';
    
    $config['components']['db']['username'] = 'root';
    
    $config['components']['db']['password'] = 'looktki2016';
    
    }


index.php 入口脚本中定义好环境

    defined('YII_ENV') or define('YII_ENV', 'dev');
    // defined('YII_ENV') or define('YII_ENV', 'prod');
